<h1 align="center">@stackup/form</h1>

<div align="center">

![Build](https://github.com/rzane/form/workflows/Build/badge.svg)
![Version](https://img.shields.io/npm/v/@stackup/form)
![Size](https://img.shields.io/bundlephobia/minzip/@stackup/form)
![License](https://img.shields.io/npm/l/@stackup/form)

</div>

A type-safe approach to managing complex form state in React.

This library provides integration with [@stackup/validate](https://github.com/rzane/validate) to handle validation. However, it should be pretty easy to integrate whatever validation library you prefer.

You should also checkout [@stackup/inputs](https://github.com/promptworks/inputs), which includes some ready-made form fields.

## Usage

```jsx
import React from "react";
import { useForm, useField, useNoValidate } from "@stackup/form";

const Form = () => {
  const form = useForm({
    initialValue: {
      email: "",
      name: ""
    },
    validate(value) {
      if (value.email) {
        return { valid: true, value };
      }
      return { valid: false, error: { email: "This field is required." } };
    },
    submit(value) {
      console.log(value);
    }
  });

  return (
    <form onSubmit={form.onSubmit}>
      <Input type="email" label="Email" field={useField(form, "email")} />
      <Input type="text" label="Name" field={useField(form, "name")} />
      <button type="submit">Save</button>
    </form>
  );
};

const Input = ({
  label,
  field: { id, value, error, touched, setValue, setTouched },
  ...props
}) => (
  <div>
    <label htmlFor={id}>{label}</label>
    <input
      {...props}
      id={id}
      value={value}
      onBlur={useCallback(() => setTouched(true), [])}
      onChange={useCallback(e => setValue(e.target.value), [setValue])}
    />
    {touched && error && <p>{error}</p>}
  </div>
);
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

- [useForm](#useform)
  - [Parameters](#parameters)
  - [Examples](#examples)
- [useField](#usefield)
  - [Parameters](#parameters-1)
  - [Examples](#examples-1)
- [useValidation](#usevalidation)
  - [Parameters](#parameters-2)
- [useSubmit](#usesubmit)
  - [Parameters](#parameters-3)
- [useFieldItem](#usefielditem)
  - [Parameters](#parameters-4)
  - [Examples](#examples-2)
- [usePushItem](#usepushitem)
  - [Parameters](#parameters-5)
  - [Examples](#examples-3)
- [useInsertItem](#useinsertitem)
  - [Parameters](#parameters-6)
  - [Examples](#examples-4)
- [useRemoveItem](#useremoveitem)
  - [Parameters](#parameters-7)
  - [Examples](#examples-5)
- [useIdentifier](#useidentifier)
  - [Parameters](#parameters-8)
- [FormOptions](#formoptions)
  - [id](#id)
  - [initialValue](#initialvalue)
  - [initialError](#initialerror)
  - [initialTouched](#initialtouched)
- [Form](#form)
  - [initialValue](#initialvalue-1)
  - [initialError](#initialerror-1)
  - [initialTouched](#initialtouched-1)
  - [setValidating](#setvalidating)
  - [setSubmitting](#setsubmitting)
- [FormField](#formfield)
  - [id](#id-1)
  - [name](#name)
  - [value](#value)
  - [error](#error)
  - [touched](#touched)
  - [isValidating](#isvalidating)
  - [isSubmitting](#issubmitting)
  - [setValue](#setvalue)
  - [setError](#seterror)
  - [setTouched](#settouched)
- [Validate](#validate)
  - [form](#form-1)
  - [execute](#execute)
- [ValidationMode](#validationmode)
  - [onChange](#onchange)
  - [onBlur](#onblur)
- [ValidateOptions](#validateoptions)
  - [touch](#touch)
- [Submit](#submit)
  - [form](#form-2)
  - [execute](#execute-1)
  - [onSubmit](#onsubmit)

### useForm

Create a new form. A form requires an initial value, a function to validate,
and a submit handler.

A form behaves just like any other field, but with some extra properties for
managing submission.

The initial value for the form can be literally anything! Usually, it's an
object, but it could be any type of value.

The `useForm` function takes two generic parameters. The first describes the
shape of your form state. The second is optional, but it describes the result
of casting your form state with a validator. The casted value is what will be
passed to `submit`.

If your form doesn't require validation, see [useNoValidate](useNoValidate).

#### Parameters

- `options` **[FormOptions](#formoptions)&lt;Value>**

#### Examples

```javascript
const form = useForm({
  initialValue: "",
  validate: useValidator(validator),
  submit: value => alert(`The value is ${value}`)
});
```

Returns **[Form](#form)&lt;Value>**

### useField

Create a field for a given property.

#### Parameters

- `field` **[FormField](#formfield)&lt;Value>**
- `name` **[Name](https://developer.mozilla.org/)**

#### Examples

```javascript
const form = useForm({
  initialValue: {
    email: "",
    profile: { name: "" } }
  }
});

const email = useField(form, "email");
const profile = useField(form, "profile");
const name = useField(profile, "name");
```

Returns **[FormField](#formfield)&lt;any>**

### useValidation

Add validation to the form using [@stackup/validate](https://github.com/rzane/validate).

#### Parameters

- `form` **[Form](#form)&lt;Value>**
- `validator` **Validator&lt;Value, Result>**
- `mode` **[ValidationMode](#validationmode)** (optional, default `{}`)

Returns **[Validate](#validate)&lt;Value, Result>**

### useSubmit

Create a submit handler for the form.

#### Parameters

- `base` **[Form](#form)&lt;Value>**
- `submit` **SubmitFn&lt;Value>**

Returns **[Submit](#submit)&lt;Value>**

### useFieldItem

Create a field for a specific index in an array.

This hook is intended for use in building forms with "Add another" functionality.

#### Parameters

- `field` **[FormField](#formfield)&lt;[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;Value>>**
- `index` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)**

#### Examples

```javascript
const form = useForm({
  initialValue: {
    pets: [{ name: "" }]
  }
});

const pets = useField(form, "pets");
const pet = useFieldItem(pets, 0);
const name = useField(pet, "name");
```

Returns **[FormField](#formfield)&lt;Value>**

### usePushItem

Adds a new value to the end to an array of values.

This can be used to create a form with repeating fields.

#### Parameters

- `field` **[FormField](#formfield)&lt;[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;Value>>**
- `value` **Value**

#### Examples

```javascript
const pets = useField(form, "pets");
const pet = useFieldItem(pets, 0);
const addPet = usePushItem(pets, { name: "" });
```

### useInsertItem

Adds a new value at a specific position to an array of values.

This can be used to create a form with repeating fields.

#### Parameters

- `field` **[FormField](#formfield)&lt;[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;Value>>**
- `index` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)**
- `value` **Value**

#### Examples

```javascript
const pets = useField(form, "pets");
const pet = useFieldItem(pets, 0);
const insert = useInsertItem(pets, 0, { name: "" });
```

### useRemoveItem

Removes a value at the given index from array of values.

This can be used to create a form with repeating fields.

#### Parameters

- `field` **[FormField](#formfield)&lt;[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;Value>>**
- `index` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)**

#### Examples

```javascript
const pets = useField(form, "pets");
const pet = useFieldItem(pets, 0);
const removePet = useRemoveItem(pets, 0);
```

### useIdentifier

Creates a unique identifier that will remain consistent across re-renders.

This hook does not currently support SSR.

#### Parameters

- `id` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?**

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)**

### FormOptions

The options that can be passed to [useForm](#useform).

#### id

Customize the base ID for all fields.

Type: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)

#### initialValue

The initial values for the form.

Type: Value

#### initialError

The initial errors on the fields.

Type: FormError&lt;Value>

#### initialTouched

The initially touched fields.

Type: FormTouched&lt;Value>

### Form

**Extends FormField&lt;Value>**

The value returned by `useForm`.

#### initialValue

The initial values for the form.

Type: Value

#### initialError

The initial errors on the fields.

Type: FormError&lt;Value>

#### initialTouched

The initially touched fields.

Type: FormTouched&lt;Value>

#### setValidating

Indicate that the form is validating

Type: SetState&lt;[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)>

#### setSubmitting

Indicate that the form is submitting

Type: SetState&lt;[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)>

### FormField

The primary form data structure.

#### id

A unique ID for this form field. This can be used to associate fields with a label.

Type: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)

#### name

The name or array index that was given to [useField](#usefield) or [useFieldItem](#usefielditem).

Type: ([string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) \| [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number))

#### value

The current value of the field.

Type: Value

#### error

An error or errors that are associated with this field or it's children.

Type: FormError&lt;Value>

#### touched

Indicates that this field or it's children have been modified by the user.

Type: FormTouched&lt;Value>

#### isValidating

Indicates that validation is currently being run

Type: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)

#### isSubmitting

Indicates that the form is currently being submitted

Type: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)

#### setValue

Change the value. Just like with `setState`, you can pass a callback
to this function to get the current value and update it.

Type: SetState&lt;Value>

#### setError

Update the error.

Type: SetState&lt;FormError&lt;Value>>

#### setTouched

Indicate that this field has been touched. This is usually called in `onBlur`.

Type: SetState&lt;FormTouched&lt;Value>>

### Validate

The value returned by `useValidate`.

#### form

A reference to form being validated.

Type: [Form](#form)&lt;Value>

#### execute

Trigger form validation.

Type: function (opts: [ValidateOptions](#validateoptions)): [Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;(Valid&lt;Result> | Invalid&lt;Value>)>

### ValidationMode

Configures when validation runs.

#### onChange

Enables validation whenever values change.

Type: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)

#### onBlur

Enables validation whenever a field is touched.

Type: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)

### ValidateOptions

Options to run validation with.

#### touch

Touch erroneous fields.

Type: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)

### Submit

The value returned by `useSubmit`.

#### form

A reference to form being submitted.

Type: [Form](#form)&lt;Value>

#### execute

Trigger form submission.

Type: function (): [Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>

#### onSubmit

This is the same as `submit`, but it'll `preventDefault` on the `event`.

Type: function (event: React.FormEvent&lt;[HTMLFormElement](https://developer.mozilla.org/docs/Web/API/HTMLFormElement)>): [Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>
