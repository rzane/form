<h1 align="center">@stackup/form</h1>

<div align="center">

![Build](https://github.com/rzane/form/workflows/Build/badge.svg)
![Version](https://img.shields.io/npm/v/@stackup/form)
![Size](https://img.shields.io/bundlephobia/minzip/@stackup/form)
![License](https://img.shields.io/npm/l/@stackup/form)

</div>

A type-safe approach to managing complex form state in React.

This library provides integration with [@stackup/validate](https://github.com/rzane/validate) to handle validation. However, it should be pretty easy to integrate whatever validation library you prefer.

## Usage

```jsx
import React from "react";
import { useForm, useField, useNoValidate } from "@stackup/form";

const Form = () => {
  const form = useForm({
    initialValue: {
      email: "",
      name: ""
    },
    validate(value) {
      if (value.email) {
        return { value };
      }
      return { error: { email: "This field is required." } };
    },
    submit(value) {
      console.log(value);
    }
  });

  return (
    <form onSubmit={form.onSubmit}>
      <Input type="email" label="Email" field={useField(form, "email")} />
      <Input type="text" label="Name" field={useField(form, "name")} />
      <button type="submit">Save</button>
    </form>
  );
};

const Input = ({
  label,
  field: { id, value, error, touched, setValue, setTouched },
  ...props
}) => (
  <div>
    <label htmlFor={id}>{label}</label>
    <input
      {...props}
      id={id}
      value={value}
      onBlur={useCallback(() => setTouched(true), [])}
      onChange={useCallback(e => setValue(e.target.value), [setValue])}
    />
    {touched && error && <p>{error}</p>}
  </div>
);
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

- [useForm](#useform)
  - [Parameters](#parameters)
  - [Examples](#examples)
- [useField](#usefield)
  - [Parameters](#parameters-1)
  - [Examples](#examples-1)
- [useFieldItem](#usefielditem)
  - [Parameters](#parameters-2)
  - [Examples](#examples-2)
- [useNoValidate](#usenovalidate)
  - [Examples](#examples-3)
- [useValidator](#usevalidator)
  - [Parameters](#parameters-3)
  - [Examples](#examples-4)
- [usePushItem](#usepushitem)
  - [Parameters](#parameters-4)
  - [Examples](#examples-5)
- [useInsertItem](#useinsertitem)
  - [Parameters](#parameters-5)
  - [Examples](#examples-6)
- [useRemoveItem](#useremoveitem)
  - [Parameters](#parameters-6)
  - [Examples](#examples-7)
- [useIdentifier](#useidentifier)
  - [Parameters](#parameters-7)
- [FormOptions](#formoptions)
  - [id](#id)
  - [submit](#submit)
  - [validate](#validate)
  - [initialValue](#initialvalue)
  - [initialError](#initialerror)
  - [initialTouched](#initialtouched)
  - [validateOnChange](#validateonchange)
  - [validateOnBlur](#validateonblur)
- [Form](#form)
  - [initialValue](#initialvalue-1)
  - [initialError](#initialerror-1)
  - [initialTouched](#initialtouched-1)
  - [isSubmitting](#issubmitting)
  - [isValidating](#isvalidating)
  - [submit](#submit-1)
  - [validate](#validate-1)
  - [onSubmit](#onsubmit)
- [FormField](#formfield)
  - [id](#id-1)
  - [name](#name)
  - [value](#value)
  - [error](#error)
  - [touched](#touched)
  - [setValue](#setvalue)
  - [setError](#seterror)
  - [setTouched](#settouched)
- [Validate](#validate-2)
- [ValidationResult](#validationresult)
- [Submit](#submit-2)

### useForm

Create a new form. A form requires an initial value, a function to validate,
and a submit handler.

A form behaves just like any other field, but with some extra properties for
managing submission.

The initial value for the form can be literally anything! Usually, it's an
object, but it could be any type of value.

The `useForm` function takes two generic parameters. The first describes the
shape of your form state. The second is optional, but it describes the result
of casting your form state with a validator. The casted value is what will be
passed to `submit`.

If your form doesn't require validation, see [useNoValidate](#usenovalidate).

#### Parameters

- `options` **[FormOptions](#formoptions)&lt;Value, Result>**

#### Examples

```javascript
const form = useForm({
  initialValue: "",
  validate: useValidate(mySchema),
  submit: value => alert(`The value is ${value}`)
});
```

Returns **[Form](#form)&lt;Value, Result>**

### useField

Create a field for a given property.

#### Parameters

- `field` **[FormField](#formfield)&lt;Value>**
- `name` **[Name](https://developer.mozilla.org/)**

#### Examples

```javascript
const form = useForm({
  initialValue: {
    email: "",
    profile: { name: "" } }
  }
});

const email = useField(form, "email");
const profile = useField(form, "profile");
const name = useField(profile, "name");
```

Returns **[FormField](#formfield)&lt;any>**

### useFieldItem

Create a field for a specific index in an array.

This hook is intended for use in building forms with "Add another" functionality.

#### Parameters

- `field` **[FormField](#formfield)&lt;[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;Value>>**
- `index` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)**

#### Examples

```javascript
const form = useForm({
  initialValue: {
    pets: [{ name: "" }]
  }
});

const pets = useField(form, "pets");
const pet = useFieldItem(pets, 0);
const name = useField(pet, "name");
```

Returns **[FormField](#formfield)&lt;Value>**

### useNoValidate

This can be used to create a form that doesn't require any validation.

#### Examples

```javascript
const form = useForm({
  submit: createUser,
  validate: useNoValidate(),
  initialValue: { name: "" }
});
```

Returns **[Validate](#validate)&lt;Value, Value>**

### useValidator

Use a validation schema produced by [@stackup/validate](https://github.com/rzane/validate)

#### Parameters

- `validator` **Validator&lt;Value, Result>**

#### Examples

```javascript
import { useForm, useValidator } from "@stackup/form";
import { schema, assert, isString } from "@stackup/validate";

const validator = schema({
  name: assert(isString)
});

const form = useForm({
  submit: createUser,
  validate: useValidator(validator),
  initialValue: { name: "" }
});
```

Returns **[Validate](#validate)&lt;Value, Result>**

### usePushItem

Adds a new value to the end to an array of values.

This can be used to create a form with repeating fields.

#### Parameters

- `field` **[FormField](#formfield)&lt;[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;Value>>**
- `value` **Value**

#### Examples

```javascript
const pets = useField(form, "pets");
const pet = useFieldItem(pets, 0);
const addPet = usePushItem(pets, { name: "" });
```

### useInsertItem

Adds a new value at a specific position to an array of values.

This can be used to create a form with repeating fields.

#### Parameters

- `field` **[FormField](#formfield)&lt;[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;Value>>**
- `index` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)**
- `value` **Value**

#### Examples

```javascript
const pets = useField(form, "pets");
const pet = useFieldItem(pets, 0);
const insert = useInsertItem(pets, 0, { name: "" });
```

### useRemoveItem

Removes a value at the given index from array of values.

This can be used to create a form with repeating fields.

#### Parameters

- `field` **[FormField](#formfield)&lt;[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;Value>>**
- `index` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)**

#### Examples

```javascript
const pets = useField(form, "pets");
const pet = useFieldItem(pets, 0);
const removePet = useRemoveItem(pets, 0);
```

### useIdentifier

Creates a unique identifier that will remain consistent across re-renders.

This hook does not currently support SSR.

#### Parameters

- `id` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?**

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)**

### FormOptions

The options that can be passed to [useForm](#useform).

#### id

Customize the base ID for all fields.

Type: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)

#### submit

Handles the submission of the form.

Type: [Submit](#submit)&lt;Result>

#### validate

Validates the form.

Type: [Validate](#validate)&lt;Value, Result>

#### initialValue

The initial values for the form.

Type: Value

#### initialError

The initial errors on the fields.

Type: FormError&lt;Value>

#### initialTouched

The initially touched fields.

Type: FormTouched&lt;Value>

#### validateOnChange

Enables validation whenever values change.

Type: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)

#### validateOnBlur

Enables validation whenever a field is touched.

Type: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)

### Form

**Extends FormField&lt;Value>**

The value returned by `useForm`.

#### initialValue

The initial values for the form.

Type: Value

#### initialError

The initial errors on the fields.

Type: FormError&lt;Value>

#### initialTouched

The initially touched fields.

Type: FormTouched&lt;Value>

#### isSubmitting

Indicates that the form is currently submitting.

Type: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)

#### isValidating

Indicates that the form is currently validating.

Type: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)

#### submit

Trigger form submission.

Type: function (): [Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>

#### validate

Trigger form validation.

Type: function (): [Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[ValidationResult](#validationresult)&lt;Value, Result>>

#### onSubmit

This is the same as `submit`, but it'll `preventDefault` on the `event`.

Type: function (event: React.FormEvent&lt;[HTMLFormElement](https://developer.mozilla.org/docs/Web/API/HTMLFormElement)>): [Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>

### FormField

The primary form data structure.

#### id

A unique ID for this form field. This can be used to associate fields with a label.

Type: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)

#### name

The name or array index that was given to [useField](#usefield) or [useFieldItem](#usefielditem).

Type: ([string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) \| [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number))

#### value

The current value of the field.

Type: Value

#### error

An error or errors that are associated with this field or it's children.

Type: FormError&lt;Value>

#### touched

Indicates that this field or it's children have been modified by the user.

Type: FormTouched&lt;Value>

#### setValue

Change the value. Just like with `setState`, you can pass a callback
to this function to get the current value and update it.

Type: SetState&lt;Value>

#### setError

Update the error.

Type: SetState&lt;FormError&lt;Value>>

#### setTouched

Indicate that this field has been touched. This is usually called in `onBlur`.

Type: SetState&lt;FormTouched&lt;Value>>

### Validate

A function that is called to validate the form.

Type: function (value: Value): ([ValidationResult](#validationresult)&lt;Value, Result> | [Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[ValidationResult](#validationresult)&lt;Value, Result>>)

### ValidationResult

The validation function should return either a `value` or an `error`.

Many validation libraries support casting the data that you input. The
`value` that you return will be passed to your submit handler.

The `error` should have the same shape of your form data, but all of the
values should be strings.

Type: ({valid: `true`, value: Result} | {valid: `false`, error: FormError&lt;Value>})

### Submit

The function called when the form is submitted. The data will be validated
and converted before this function is called.

Type: function (value: Result): (void | [Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;void>)
